package com;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.*;
import java.util.Properties;




public class SaveNameAndSurname extends javax.servlet.http.HttpServlet {
    /**
	 * 
	 */
	private static final long serialVersionUID = 1L;

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    }

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String name;
        String surname;

        name = request.getParameter("name");
        surname = request.getParameter("surname");
        String url;

        if (!name.isEmpty()) {
            if (!surname.isEmpty()) {
                 url = saveData(name + " " + surname);
            } else {
                throw new NullPointerException("Parametrs can`t be null...");
            }
        } else {
            throw new NullPointerException("Parametrs can`t be null.");
        }

        writeResponse(response, url);
    }

    private String saveData(String data) throws IOException {

        String fullFileName = getFullFileName();
           
        File file = new File(fullFileName);
            if (!file.exists()) {
                if (!file.createNewFile()) {
                    throw new IOException("Can`t create file.");
                }
            }

        try (BufferedWriter bufferedWriter = new BufferedWriter(new FileWriter(fullFileName, true))) {
            bufferedWriter.write(data);
            bufferedWriter.append('\n');
        } catch (IOException e) {
            throw new IOException("Error write data.");
        }
        
        return fullFileName;
    }

    private String getFullFileName() {
        Properties fileProperties = new Properties();
        try (FileInputStream fileInputStream = new FileInputStream("config.properties")) {
            fileProperties.load(fileInputStream);
        } catch (IOException e) {
            e.printStackTrace();
        }
        return fileProperties.getProperty("filePatch") + fileProperties.getProperty("fileName");
    }

    private void writeResponse(HttpServletResponse response, String url) throws IOException {
        PrintWriter out = response.getWriter();
        out.println("Data saved");
        out.println("save data to " + url);
        out.println(System.getProperty("user.dir") + "/?");
        out.close();
    }
}
